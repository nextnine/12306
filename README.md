# 高并发火车票购票系统资料库

本仓库集中存放高并发火车票购票系统的需求与设计资料。`12306` 目录为主体内容，其余同级目录为附件快照或参考资料。  

## 目录导览
- `12306/guide.md`：软件文档编写指南。  
- `12306/gpt生成文档/需求分析文档.md`：需求规格说明（SRS），含功能、性能与接口约束。  
- `12306/gpt生成文档/系统设计文档.md`：概要设计说明（ADS），含核心流程、组件/部署视图、接口示例。  
- `12306/mgx生成文档/requirements_analysis_v13.md`、`system_design_v13.md`：另一版需求与设计草案。  
- `12306/需求分析与系统设计报告v.docx`：需求与设计报告的 Word 版本。  

## 核心需求要点（摘自 SRS）
- 功能域：查询、下单、支付/出票、退改候补、运营/风控、通知/客服、可观测。查询需支持车次/日期/席别筛选与缓存降级；下单需实名校验、限购/冲突校验、排队 token 与幂等；支付需验签、防重放与失败补偿；退改/候补需展示费用明细、双阶段改签与自动重试；通知需模板化与熔断；可观测需监控、日志审计、压测/演练开关。  
- 业务规则与控制：动态排队速率 `r = min(0.02 * remain, 2000)`，冲突限购与改签规则（同乘客时间窗限持一票，改签成功后回补库存），外部依赖需明确 SLA/超时/重试/熔断策略。  
- 性能与可用性：查询 P95 < 120ms、下单出队后 P95 < 3s、排队 P95 < 60s，峰值写入 TPS ≥ 20 万；可用性目标查询 99.99%、下单 99.95%，核心错误率 < 0.1%，库存/票数强一致，金额以分为单位。  
- 接口与故障处理：写接口携带 `idempotent_key` 与鉴权/签名头；幂等冲突 409、频控 429、排队超限 423 等标准错误码；外部超时触发重试或降级，幂等返回已有结果，候补与补偿流程可回滚并可追溯。  

## 设计要点（摘自 ADS）
- 核心流程：缓存优先查询 → 排队下单 → 库存预扣与锁座 → 支付 → 出票 → 通知 → 退改/候补补偿，并在每阶段暴露命中率、延迟、失败率等指标。  
- 组件视图：客户端经 CDN/WAF 与 API Gateway（鉴权/限流/灰度）进入业务域：查询、订单（排队/幂等/状态机）、库存预扣、锁座、支付服务、出票、退改/候补、风控/配置、通知；数据层使用 Redis（缓存/锁）、Kafka/RabbitMQ（事件）、MySQL 分片（OLTP）、Elasticsearch（检索）、对象存储（归档）；外部对接支付网关、实名核验、运行图/座席同步、短信/邮件/推送。  
- 部署视图：CDN → 负载均衡 → API Gateway → K8s 中的各业务 Pod；Redis Cluster、Kafka/RabbitMQ 多分区、MySQL 分库分表（主从/Proxy）、ES 集群支撑高并发，数据库冷热备份/归档。  

## 使用建议
1. 先阅读 `guide.md` 获取文档格式规范。  
2. 按 SRS → ADS 的顺序梳理需求与架构；若需另一视角，可参考 `mgx生成文档` 中的第 13 版草案。  
3. 若需可编辑版本，可打开 `需求分析与系统设计报告v.docx`。  

