# 高并发火车票购票系统需求分析与系统设计文档

## 版本历史

| 版本号 | 修订日期 | 修订人 | 修订原因 | 修订内容概述 |
|--------|----------|--------|----------|--------------|
| 1.0 | 2025-12-23 | 系统架构团队 | 初始版本 | 创建完整的需求分析与系统设计文档 |

---

## 目录

1. [前言](#1-前言)
2. [引言](#2-引言)
3. [术语表](#3-术语表)
4. [用户需求定义](#4-用户需求定义)
5. [系统体系结构](#5-系统体系结构)
6. [系统需求规格说明](#6-系统需求规格说明)
7. [系统模型](#7-系统模型)
8. [系统演化](#8-系统演化)
9. [附录](#9-附录)

---

## 1. 前言

### 1.1 文档目标读者

本文档面向以下读者群体：

- **产品经理**：了解系统功能规划和业务价值，把握产品方向和用户需求
- **系统架构师**：掌握系统整体架构和技术选型，指导技术实施方案
- **开发工程师**：理解详细的功能需求和技术实现方案，进行代码开发
- **测试工程师**：明确测试重点和性能指标，制定测试策略和用例
- **运维工程师**：了解系统部署和运维要求，保障系统稳定运行
- **项目管理人员**：把握项目范围和里程碑，协调资源和进度
- **技术决策者**：评估技术方案和投资回报，做出战略决策

### 1.2 文档阅读指南

本文档采用自然语言描述，穿插多种形式化表达方式：

- **用例图**：展示用户与系统的交互关系
- **泳道图/时序图**：展示跨系统、跨服务的业务流程
- **类图**：展示核心领域对象的结构和关系
- **状态机图**：展示订单、支付等对象的状态转换
- **架构图**：展示系统的整体架构和组件关系
- **数据流图**：展示数据在系统中的流转过程
- **规则表格**：定义业务规则和验证逻辑
- **计算公式**：定义性能指标和业务计算规则

建议读者根据角色重点阅读相关章节：
- 产品经理重点阅读：第2章引言、第4章用户需求定义
- 架构师重点阅读：第5章系统体系结构、第6章系统需求规格说明
- 开发工程师重点阅读：第6章系统需求规格说明、第7章系统模型
- 运维工程师重点阅读：第5章系统体系结构、第9章附录

---

## 2. 引言

### 2.1 系统概述

高并发火车票购票系统是一个面向全国铁路旅客的在线购票平台，旨在为用户提供便捷、高效、安全的火车票预订服务。系统需要支持海量用户同时在线查询、预订和购买火车票，特别是在春运、节假日等高峰期，系统需要承受每秒数十万次的并发请求。

本系统采用**微服务架构**，结合**分布式缓存**、**消息队列**、**分库分表**等技术，构建高并发、高可用、高性能的购票平台。系统设计遵循互联网工程最佳实践，确保在极端流量场景下的稳定性和可靠性。

### 2.2 系统意义和必要性

#### 2.2.1 业务价值

**提升旅客体验**：
- 7×24小时不间断在线服务，随时随地购票
- 减少线下排队时间，提高购票效率
- 提供多样化的支付方式和便捷的退改签服务
- 智能推荐和余票提醒，提升用户满意度

**提高运营效率**：
- 优化座位资源分配，提高上座率
- 实时掌握客流数据，支持运营决策
- 降低人工售票成本，提升服务质量
- 数据化运营，精准营销

**保障出行安全**：
- 实名制购票，保障旅客身份真实性
- 防刷票机制，打击黄牛和恶意抢票
- 支付安全保障，保护用户资金安全
- 数据加密存储，保护用户隐私

#### 2.2.2 技术挑战

本系统面临以下核心技术挑战：

**高并发挑战**：
- 春运期间峰值可达每秒50万+并发请求
- 热门车次开售瞬间流量洪峰可达100万+QPS
- 需要支持千万级用户同时在线
- 系统需要在高负载下保持稳定响应

**高可用挑战**：
- 系统可用性需达到99.99%（年停机时间<53分钟）
- 任何单点故障不能影响整体服务
- 需要支持异地容灾和快速故障切换
- 保证核心功能在极端情况下可用

**数据一致性挑战**：
- 严格防止超卖和重复售票
- 保证订单和库存的强一致性
- 处理分布式事务的复杂场景
- 在高并发下保证数据准确性

### 2.3 系统功能概述

本系统提供以下核心功能：

**用户管理功能**：用户注册、登录、认证、实名认证、常用乘车人管理

**车票查询功能**：车次查询和筛选、余票实时查询、车次详情查询、票价查询

**订单管理功能**：订单创建和提交、订单支付和确认、订单查询和管理、退票和改签处理

**支付功能**：多种支付方式支持、支付安全保障、退款处理、支付对账

**通知功能**：订单确认通知、出行提醒、退改签通知、余票提醒

**候补购票功能**：候补订单提交、自动抢票、候补状态查询、候补成功通知

---

## 3. 术语表

### 3.1 性能相关术语

| 术语 | 英文 | 定义 | 说明 |
|------|------|------|------|
| 高并发 | High Concurrency | 系统同时处理大量请求的能力 | 本系统需支持每秒50万+并发请求 |
| QPS | Queries Per Second | 每秒查询率 | 衡量系统吞吐量的关键指标，查询服务目标10万QPS |
| TPS | Transactions Per Second | 每秒事务数 | 衡量系统处理能力的指标，订单服务目标2万TPS |
| RT | Response Time | 响应时间 | 从请求发出到收到响应的时间，目标<200ms |

### 3.2 架构相关术语

| 术语 | 英文 | 定义 | 说明 |
|------|------|------|------|
| 微服务 | Microservices | 按业务功能拆分的独立服务 | 本系统采用微服务架构，包含9个核心服务 |
| 负载均衡 | Load Balancing | 流量分发机制 | 使用LVS+Nginx实现四层和七层负载均衡 |
| 限流 | Rate Limiting | 限制请求速率 | 使用Sentinel保护系统不被流量冲垮 |
| 降级 | Degradation | 关闭非核心功能 | 保证核心功能在高负载下可用 |
| 熔断 | Circuit Breaking | 快速失败机制 | 防止故障扩散，保护系统稳定性 |

### 3.3 数据相关术语

| 术语 | 英文 | 定义 | 说明 |
|------|------|------|------|
| 分库分表 | Sharding | 数据库水平拆分 | 用户库分16库，订单库分32库，提升处理能力 |
| 读写分离 | Read-Write Splitting | 读写操作分离 | 主库写，从库读，提升数据库性能 |
| 缓存穿透 | Cache Penetration | 查询不存在的数据 | 使用布隆过滤器防护 |
| 缓存雪崩 | Cache Avalanche | 大量缓存同时失效 | 设置随机过期时间防护 |
| 缓存击穿 | Cache Breakdown | 热点数据缓存失效 | 使用互斥锁防护 |

### 3.4 业务相关术语

| 术语 | 英文 | 定义 | 说明 |
|------|------|------|------|
| 超卖 | Overselling | 售出票数超过实际库存 | 通过分布式锁和乐观锁严格防止 |
| 实名制 | Real-name System | 购票需实名认证 | 国家铁路安全要求，与公安部对接验证 |
| 候补购票 | Waitlist Ticketing | 无票时排队候补 | 提升用户体验和座位利用率 |
| 黄牛 | Ticket Scalper | 恶意抢票并高价倒卖 | 通过多种技术手段防范 |

---

## 4. 用户需求定义

### 4.1 目标用户群体分析

#### 4.1.1 用户画像

**用户特征详细分析**：

| 用户类型 | 年龄段 | 使用频率 | 主要需求 | 痛点 | 解决方案 |
|----------|--------|----------|----------|------|----------|
| 商务出行用户 | 25-45岁 | 高频（每月2-4次） | 快速购票、改签灵活、商务座 | 时间紧迫、需要发票 | 快速通道、电子发票、VIP服务 |
| 学生群体 | 18-25岁 | 中频（寒暑假、节假日） | 学生票优惠、抢票成功率 | 预算有限、高峰期抢票难 | 学生认证、候补购票、余票提醒 |
| 探亲访友用户 | 30-60岁 | 低频（春节、节假日） | 操作简单、多人购票 | 不熟悉操作、需要帮助 | 简化流程、语音辅助、客服支持 |
| 旅游用户 | 25-50岁 | 中低频（节假日、周末） | 行程规划、往返票 | 需要灵活退改 | 组合推荐、灵活退改政策 |

### 4.2 功能需求

#### 4.2.1 用户管理模块

**FR-UM-001：用户注册**
- **优先级**：P0（必须实现）
- **描述**：用户可以通过手机号或邮箱注册账号
- **输入**：手机号/邮箱、密码、验证码
- **输出**：注册成功/失败提示
- **业务规则**：
  - 手机号必须通过验证码验证
  - 密码长度8-20位，包含字母和数字
  - 同一手机号只能注册一个账号
  - 验证码6位数字，有效期5分钟

**FR-UM-002：用户登录**
- **优先级**：P0
- **描述**：用户可以通过多种方式登录系统
- **登录方式**：账号密码登录、手机验证码登录、第三方登录（微信、QQ、支付宝）、扫码登录

**FR-UM-003：实名认证**
- **优先级**：P0
- **描述**：用户必须完成实名认证才能购票
- **认证信息**：姓名、身份证号、手机号
- **验证方式**：与公安部身份信息库对接验证、支持人脸识别认证

#### 4.2.2 车次查询模块

**FR-TQ-001：车次查询**
- **优先级**：P0
- **描述**：用户可以查询指定日期、出发地到目的地的所有车次
- **查询条件**：出发地（必填）、目的地（必填）、出发日期（必填）、车次类型（可选）、出发时间段（可选）、座位类型（可选）
- **返回信息**：车次号、车次类型、出发/到达站点和时间、历时、各座位类型余票数量和价格、是否可购买、候补

#### 4.2.3 订单管理模块

**FR-OM-001：创建订单**
- **优先级**：P0
- **描述**：用户选择车次和座位后创建订单
- **业务规则**：
  - 单次最多购买5张票
  - 订单提交后锁定座位15分钟
  - 超时未支付自动取消
  - 同一车次、同一乘车人只能购买一张票

**FR-OM-002：订单支付**
- **优先级**：P0
- **描述**：用户选择支付方式完成支付
- **支付方式**：微信支付、支付宝、银联支付、铁路畅行会员余额

**FR-OM-003：订单查询**
- **优先级**：P0
- **描述**：用户可以查询历史订单
- **查询条件**：订单状态、时间范围、车次号

**FR-OM-004：订单退票**
- **优先级**：P0
- **描述**：用户可以申请退票
- **退票规则**：按照退票规则表计算退票费、开车后不可退票、退款原路返回

### 4.3 非功能性需求

#### 4.3.1 性能需求

**响应时间要求**：

| 操作类型 | 平均响应时间 | 95分位响应时间 | 99分位响应时间 |
|----------|--------------|----------------|----------------|
| 车次查询 | < 200ms | < 500ms | < 1s |
| 订单提交 | < 500ms | < 1s | < 2s |
| 支付处理 | < 1s | < 2s | < 3s |
| 订单查询 | < 300ms | < 800ms | < 1.5s |

**吞吐量要求**：
- **日常流量**：查询QPS 10万/秒，下单TPS 2万/秒，日订单量 500万单
- **高峰流量**：查询QPS 50万/秒，下单TPS 10万/秒，日订单量 1000万单
- **极限流量**：查询QPS 100万/秒，下单TPS 20万/秒，瞬时并发用户 200万

#### 4.3.2 可用性需求

**系统可用性**：
- **目标**：99.99%可用性（年停机时间<53分钟）
- **措施**：多机房部署、异地容灾、故障自动切换、实时监控告警

**故障恢复**：
- **RTO（恢复时间目标）**：< 5分钟
- **RPO（恢复点目标）**：< 1分钟

#### 4.3.3 安全性需求

**数据安全**：
- **传输安全**：全站HTTPS加密
- **存储安全**：敏感数据加密存储（身份证号、手机号、银行卡号）、密码使用bcrypt加密
- **数据备份**：每日全量备份、实时增量备份、异地备份存储

**身份认证与授权**：
- **认证机制**：用户名密码认证、短信验证码认证、第三方OAuth认证、双因素认证（可选）
- **授权机制**：基于RBAC的权限控制、API接口鉴权、操作日志记录

---

## 5. 系统体系结构

### 5.1 系统架构设计原则

在设计高并发火车票购票系统时，我们遵循以下核心架构原则：

**高可用性原则**：系统可用性达到99.99%，采用多机房部署和异地容灾

**高并发原则**：支持峰值10万+QPS，采用多级缓存、消息队列、分库分表等技术

**高性能原则**：查询响应时间<200ms，下单响应时间<3s

**可扩展性原则**：支持水平扩展，采用微服务架构

**数据一致性原则**：保证订单和库存的强一致性，严格防止超卖

### 5.2 微服务架构划分

本系统采用微服务架构，按业务领域划分为9个核心服务：

**1. 用户服务 (User Service)**：用户注册、登录、认证、信息管理

**2. 车票查询服务 (Search Service)**：车次查询、余票查询、站点查询

**3. 订单服务 (Order Service)**：订单创建、查询、状态管理

**4. 库存服务 (Inventory Service)**：库存管理、库存扣减、座位分配

**5. 支付服务 (Payment Service)**：支付接口集成、支付状态查询、退款处理

**6. 排队服务 (Queue Service)**：虚拟排队、流量控制、令牌分发

**7. 通知服务 (Notification Service)**：短信通知、邮件通知、站内消息、推送通知

**8. 风控服务 (Risk Service)**：防刷票检测、异常行为识别、黑名单管理

**9. 车票服务 (Ticket Service)**：车票信息管理、车次管理、站点管理

### 5.3 技术选型

#### 5.3.1 编程语言与框架

| 组件类型 | 技术选型 | 说明 |
|---------|---------|------|
| 后端语言 | Java 17 | 成熟稳定，生态丰富 |
| 微服务框架 | Spring Cloud Alibaba | 国内最佳实践，集成Nacos、Sentinel等 |
| Web框架 | Spring Boot 3.x | 快速开发，约定优于配置 |
| 前端框架 | React 18 + TypeScript | 组件化开发，类型安全 |

#### 5.3.2 中间件选型

| 中间件类型 | 技术选型 | 说明 |
|-----------|---------|------|
| 注册中心 | Nacos 2.x | 服务发现、配置管理 |
| 网关 | Spring Cloud Gateway | 统一入口，路由转发 |
| 负载均衡 | Nginx + LVS | 四层+七层负载均衡 |
| 缓存 | Redis Cluster | 分布式缓存 |
| 消息队列 | Kafka + RabbitMQ | Kafka削峰填谷，RabbitMQ业务解耦 |
| 搜索引擎 | Elasticsearch | 车次搜索、日志分析 |
| 限流熔断 | Sentinel | 流量控制、熔断降级 |
| 分布式事务 | Seata | TCC、AT模式 |
| 链路追踪 | SkyWalking | 全链路监控 |
| 监控告警 | Prometheus + Grafana | 指标监控、可视化 |

#### 5.3.3 数据存储选型

| 存储类型 | 技术选型 | 说明 |
|---------|---------|------|
| 关系数据库 | MySQL 8.0 | 主数据存储 |
| 缓存数据库 | Redis 7.x | 热点数据缓存 |
| 文档数据库 | MongoDB | 日志、会话存储 |
| 时序数据库 | InfluxDB | 监控指标存储 |
| 对象存储 | MinIO/OSS | 文件存储 |

### 5.4 数据库设计

#### 5.4.1 分库分表策略

**用户库分库**：按用户ID取模分16库
```
database_index = user_id % 16
```

**订单库分库**：按订单ID取模分32库
```
database_index = order_id % 32
```

**分表策略**：
- 订单表：每库按月分表
- 用户表：每库按用户ID分64表

#### 5.4.2 核心表结构

**用户表 (t_user)**
```sql
CREATE TABLE t_user_{N} (
    id BIGINT PRIMARY KEY COMMENT '用户ID',
    username VARCHAR(50) UNIQUE NOT NULL COMMENT '用户名',
    password VARCHAR(128) NOT NULL COMMENT '密码(加密)',
    real_name VARCHAR(50) COMMENT '真实姓名',
    id_card VARCHAR(18) UNIQUE COMMENT '身份证号',
    phone VARCHAR(11) UNIQUE COMMENT '手机号',
    email VARCHAR(100) COMMENT '邮箱',
    user_type TINYINT DEFAULT 0 COMMENT '用户类型:0普通,1VIP',
    status TINYINT DEFAULT 1 COMMENT '状态:0禁用,1正常',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    version INT DEFAULT 0 COMMENT '乐观锁版本号',
    INDEX idx_phone (phone),
    INDEX idx_id_card (id_card)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

**订单表 (t_order)**
```sql
CREATE TABLE t_order_{N} (
    id BIGINT PRIMARY KEY COMMENT '订单ID',
    order_no VARCHAR(32) UNIQUE NOT NULL COMMENT '订单号',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    train_number VARCHAR(20) NOT NULL COMMENT '车次号',
    departure_station VARCHAR(50) NOT NULL COMMENT '出发站',
    arrival_station VARCHAR(50) NOT NULL COMMENT '到达站',
    departure_time DATETIME NOT NULL COMMENT '出发时间',
    seat_type TINYINT NOT NULL COMMENT '座位类型',
    seat_number VARCHAR(10) COMMENT '座位号',
    passenger_name VARCHAR(50) NOT NULL COMMENT '乘客姓名',
    passenger_id_card VARCHAR(18) NOT NULL COMMENT '乘客身份证',
    ticket_price DECIMAL(10,2) NOT NULL COMMENT '票价',
    order_status TINYINT DEFAULT 0 COMMENT '订单状态:0待支付,1已支付,2已取消,3已退款',
    pay_time DATETIME COMMENT '支付时间',
    expire_time DATETIME COMMENT '过期时间',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    version INT DEFAULT 0 COMMENT '乐观锁版本号',
    INDEX idx_user_id (user_id),
    INDEX idx_order_no (order_no),
    INDEX idx_train_number (train_number)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单表';
```

**库存表 (t_inventory)**
```sql
CREATE TABLE t_inventory (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    train_number VARCHAR(20) NOT NULL COMMENT '车次号',
    train_date DATE NOT NULL COMMENT '发车日期',
    departure_station VARCHAR(50) NOT NULL COMMENT '出发站',
    arrival_station VARCHAR(50) NOT NULL COMMENT '到达站',
    seat_type TINYINT NOT NULL COMMENT '座位类型',
    total_seats INT NOT NULL COMMENT '总座位数',
    available_seats INT NOT NULL COMMENT '可用座位数',
    locked_seats INT DEFAULT 0 COMMENT '锁定座位数',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    version INT DEFAULT 0 COMMENT '乐观锁版本号',
    UNIQUE KEY uk_train_route_seat (train_number, train_date, departure_station, arrival_station, seat_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='库存表';
```

---

## 6. 系统需求规格说明

### 6.1 高并发解决方案

#### 6.1.1 负载均衡架构

**四层负载均衡 (LVS)**：
- 模式: DR模式(Direct Routing)
- 调度算法: 加权最小连接(WLC)
- 会话保持: 源地址哈希

**七层负载均衡 (Nginx)**：
- 最小连接数算法
- 健康检查，自动剔除故障节点
- 支持HTTP/2和WebSocket

#### 6.1.2 限流策略

**网关层限流 (Sentinel)**：
- 查询接口限流: 10万QPS
- 下单接口限流: 5万QPS，使用预热模式
- 支付接口限流: 2万QPS

**用户维度限流**：
使用令牌桶算法实现用户维度限流，防止单个用户过度请求

#### 6.1.3 缓存策略

**多级缓存架构**：
- **L1缓存**：本地缓存（Caffeine），存储热点车次数据，TTL=1分钟
- **L2缓存**：Redis缓存，存储所有车次数据，TTL=5分钟

**缓存数据类型**：

| 数据类型 | 缓存Key | 数据结构 | TTL | 说明 |
|----------|---------|----------|-----|------|
| 车次信息 | train:{train_no} | Hash | 1小时 | 车次基本信息 |
| 余票数据 | stock:{train_no}:{date} | Hash | 5分钟 | 各座位类型余票 |
| 用户信息 | user:{user_id} | Hash | 30分钟 | 用户基本信息 |
| 用户会话 | session:{token} | String | 7天 | 登录会话 |
| 分布式锁 | lock:seat:{seat_id} | String | 30秒 | 座位锁 |

**缓存一致性保证**：
- Cache Aside模式：更新数据库后删除缓存
- 延迟双删：删除缓存 → 更新数据库 → 延迟100ms → 再次删除缓存
- 订阅Binlog：监听数据库变更，异步更新缓存

### 6.2 分布式事务处理

#### 6.2.1 TCC模式 (订单+库存)

**Try阶段 - 资源预留**：
- 检查库存
- 预留库存(锁定)
- 记录事务日志

**Confirm阶段 - 确认提交**：
- 确认扣减库存
- 更新事务状态

**Cancel阶段 - 回滚**：
- 释放锁定库存
- 更新事务状态

#### 6.2.2 本地消息表 (最终一致性)

**本地消息表设计**：
```sql
CREATE TABLE t_local_message (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    message_id VARCHAR(64) UNIQUE NOT NULL COMMENT '消息ID',
    topic VARCHAR(100) NOT NULL COMMENT '消息主题',
    content TEXT NOT NULL COMMENT '消息内容',
    status TINYINT DEFAULT 0 COMMENT '状态:0待发送,1已发送,2发送失败',
    retry_count INT DEFAULT 0 COMMENT '重试次数',
    max_retry INT DEFAULT 3 COMMENT '最大重试次数',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='本地消息表';
```

### 6.3 安全设计

#### 6.3.1 防刷票机制

**滑动验证码**：生成滑块验证码，存储验证信息到Redis，验证用户操作

**行为分析**：
- 统计1分钟内的请求次数
- 超过30次/分钟，判定为异常
- 检查操作时间间隔（小于100ms可能是机器人）

#### 6.3.2 防黄牛策略

**实名制验证**：
- 校验身份证格式
- 调用公安部接口验证
- 缓存验证结果(24小时)

**购票限制**：
- 同一用户同一车次同一天只能购买5张票
- 同一用户同一身份证号一天最多购买10张票

#### 6.3.3 排队系统

**虚拟排队设计**：
- 生成排队令牌
- 加入Redis有序集合(按时间戳排序)
- 前1000名可以进入购票

---

## 7. 系统模型

### 7.1 订单创建流程

**订单状态机**：
```
待支付 → 已支付 → 已出票
   ↓         ↓         ↓
已取消    已退票    已退票
```

### 7.2 支付流程

**支付状态机**：
```
待支付 → 支付中 → 支付成功 → 已退款
   ↓         ↓         ↓
已关闭    支付失败    [结束]
```

---

## 8. 系统演化

### 8.1 版本演进计划

| 版本 | 时间 | 主要特性 | 技术升级 |
|------|------|----------|----------|
| V1.0 | 2024 Q1 | MVP上线，基础购票功能 | Spring Boot单体应用 |
| V2.0 | 2024 Q3 | 性能优化，支持10万并发 | 垂直拆分、Redis缓存 |
| V3.0 | 2025 Q1 | 微服务化，支持50万并发 | Spring Cloud、分库分表 |
| V4.0 | 2025 Q3 | 服务网格，智能调度 | Istio、Kubernetes |
| V5.0 | 2026 Q1 | 云原生，弹性伸缩 | Serverless、多云部署 |

---

## 9. 附录

### 9.1 硬件配置要求

#### 9.1.1 应用服务器

| 环境 | CPU | 内存 | 磁盘 | 网络 | 数量 |
|------|-----|------|------|------|------|
| 开发环境 | 4核 | 8GB | 100GB SSD | 1Gbps | 5台 |
| 测试环境 | 8核 | 16GB | 200GB SSD | 1Gbps | 10台 |
| 预发布环境 | 16核 | 32GB | 500GB SSD | 10Gbps | 20台 |
| 生产环境 | 32核 | 64GB | 1TB SSD | 10Gbps | 500台 |

#### 9.1.2 数据库服务器

**MySQL配置**：

| 角色 | CPU | 内存 | 磁盘 | IOPS | 数量 |
|------|-----|------|------|------|------|
| 主库 | 64核 | 256GB | 10TB SSD | 500K | 10台 |
| 从库 | 32核 | 128GB | 10TB SSD | 300K | 30台 |

**Redis配置**：

| 角色 | CPU | 内存 | 网络 | 数量 |
|------|-----|------|------|------|
| 主节点 | 16核 | 128GB | 10Gbps | 20台 |
| 从节点 | 16核 | 128GB | 10Gbps | 40台 |

### 9.2 性能优化总结

**关键性能指标**：

| 指标 | 目标值 | 优化措施 |
|-----|-------|---------|
| 查询QPS | 100,000+ | Redis缓存 + CDN加速 |
| 下单QPS | 50,000+ | 排队系统 + 消息队列削峰 |
| 查询响应时间 | < 200ms | 多级缓存 + 数据库索引优化 |
| 下单响应时间 | < 3s | 异步处理 + 预扣库存 |
| 系统可用性 | 99.99% | 异地双活 + 自动故障切换 |
| 数据一致性 | 强一致 | 分布式事务 + 本地消息表 |

---

